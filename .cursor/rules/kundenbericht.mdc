

Ein **zentrales Reporting-Cockpit pro Kunde**, das alle relevanten Aktivitäten bündelt:

* Anfragen → Angebote → Rechnungen → Mahnungen → Projekte
* plus **Kennzahlen, Verlauf, Dokumente, Notizen**
* alles **zeitraumfilterbar**
* alles **immer eindeutig mit Kunde verlinkt**
* optional **KI-gestützte Zusammenfassung & Berichtsausgabe**

---

## 1) Seitenstruktur und Navigation

### 1.1 Kundenberichte Übersicht

**Route:** `/kundenberichte`
**Zweck:** Überblick über alle Kunden + schnelle Filterung + Einstieg in Detailberichte.

**Oben: KPI-Cards (klickbar als Filter)**
Empfohlen:

* **Aktive Kunden** (Kunden mit Aktivität im Zeitraum)
* **Kunden mit offenen Rechnungen**
* **Kunden mit Mahnung offen**
* **Umsatz im Zeitraum**
* **Ø Zahlungsdauer** (optional später)
* **Top 5 Kunden nach Umsatz** (als Card/Widget)
* **Kunden ohne Aktivität (90 Tage)** (Reaktivierungs-Liste)

**Darunter: Tabelle „Kundenliste“**
Spalten (Vorschlag):

* Kunde (Name + Kundennummer)
* Ansprechpartner
* Projekte (Anzahl)
* Angebote (Anzahl)
* Rechnungen: offen / bezahlt
* Mahnungen: offen
* Umsatz im Zeitraum
* letzte Aktivität
* Status (aktiv/gesperrt/mahnsperre)

**Aktionsspalte:**

* „Bericht öffnen“ (Link zur Kundenbericht-Detailseite)
* optional: „Kunde öffnen“, „Neues Angebot“, „Neue Rechnung“ (Quick Actions)

---

### 1.2 Kundenbericht Detailseite

**Route:** `/kundenberichte/:kundeId`
**Zweck:** Vollständige Sicht auf alle Kundenaktivitäten + Reporting + KI-Insights.

**Headerbereich**

* Kundenname + Kundennummer
* Verlinkung: „Kundenprofil öffnen“
* Zeitraumfilter global (wirkt auf alle Tabs/Widgets)
* Export-Buttons (PDF/CSV später)

**Tabs/Section-Struktur (empfohlen)**

1. **Übersicht**
2. **Anfragen**
3. **Angebote**
4. **Rechnungen**
5. **Mahnungen**
6. **Projekte**
7. **Statistiken & Reports**
8. **KI-Bericht** (oder KI-Panel in Übersicht)

---

## 2) Inhalt der Kundenbericht-Detailseite

### 2.1 Übersicht (Dashboard pro Kunde)

**KPI-Cards (klickbar / drill-down)**

* Anzahl Anfragen im Zeitraum
* Angebotsvolumen (Summe Angebote)
* Rechnungsvolumen (Summe Rechnungen)
* Offene Beträge
* Mahnungen offen
* Zahlungsquote (% bezahlt)
* Durchschnittliche Zahlungszeit (optional)
* Aktive Projekte / abgeschlossene Projekte

**Timeline / Aktivitätsfeed**

* „Was ist passiert“: Anfrage → Angebot → Rechnung → Mahnung → Zahlung
* Klick auf Eintrag führt zur jeweiligen Detailseite (Anfrage/Angebot/Rechnung/Mahnung/Projekt)

**Hinweise/Flags**

* „Mahnsperre aktiv“ (falls Kunde nicht gemahnt werden darf)
* „Wichtiger Kunde“ (Tag)
* „Risikokunde“ (optional später)

---

### 2.2 Tabellen pro Tab (Anfragen / Angebote / Rechnungen / Mahnungen / Projekte)

Jeder Tab:

* Tabelle + Filter (Status, Zeitraum, Projekt)
* Link zu Details (z. B. Rechnungsdetailsseite)
* Summenzeile (z. B. Summe im Zeitraum)

Beispiele:

* **Rechnungen-Tab:** offen/bezahlte, Fälligkeit, Badge „Mahnung offen“
* **Mahnungen-Tab:** Mahnstufe, Genehmigungsstatus, Versandstatus, verlinkt zur Rechnung
* **Projekte-Tab:** Status, Umsatz je Projekt, offene ToDos (optional)

---

## 3) Verlinkungslogik (wichtig: „immer mit Kunde verknüpft“)

### 3.1 Datenmodell-Grundsatz

Alle Entities müssen eine klare Customer-Verbindung haben:

* Anfrage → `customerId` (+ optional `projectId`)
* Angebot → `customerId` + `projectId`
* Rechnung → `customerId` + `projectId`
* Mahnung → `invoiceId` und dadurch indirekt `customerId` (trotzdem optional `customerId` redundanter Index für schnelle Queries)
* Projekt → `customerId`

### 3.2 Navigationsprinzip

* Kundenbericht ist ein „Hub“, aber:

  * Jede Zeile verlinkt auf echte Details (Rechnung, Angebot etc.)
  * Von jeder Detailseite zurück: „Zum Kundenbericht“

---

## 4) Zeitraumfilter (Global + Local)

### 4.1 Globaler Zeitraumfilter

* sitzt oben auf der Kundenbericht-Detailseite
* wirkt auf:

  * KPI-Cards
  * Tabellen
  * Statistiken
  * KI-Report

### 4.2 Zusätzliche Filter

* Projektfilter innerhalb Kundenbericht
* Statusfilter (offen/bezahlt/überfällig/genehmigt)
* Volltextsuche (z. B. Rechnungs-ID, Projektnamen)

---

## 5) KI-Features (Bericht & Zusammenfassung)

### 5.1 KI-Zusammenfassung (Kernfeature)

**Ziel:** Automatisch in Textform erklären, was im Zeitraum passiert ist.

Beispiele für KI-Ausgaben:

* „Im Zeitraum 01.10–31.12 wurden 3 Angebote erstellt…“
* „Offen sind 2 Rechnungen (gesamt 4.230€), eine Mahnung ist genehmigt aber nicht versendet…“
* „Zahlungsverhalten: durchschnittlich 19 Tage nach Rechnung…“
* „Empfehlung: Mahnsperre prüfen / Zahlungsziel anpassen / Rahmenvertrag anbieten…“

### 5.2 KI-Report als „Berichtsdokument“

* Generiert strukturierte Abschnitte:

  * Executive Summary
  * Aktivitäten (Timeline)
  * Finanzen (Umsatz, offen, bezahlt)
  * Projekte (Status & Fortschritt)
  * Risiken/Empfehlungen
* Ausgabeformat: HTML/PDF (später)

### 5.3 KI-Chat im Kundenbericht (optional)

* „Frage zu diesem Kunden stellen“
* Beispiel: „Welche Rechnungen sind überfällig?“ / „Was waren die wichtigsten Projekte dieses Jahr?“

**Wichtig:** KI nutzt nur Daten dieses Kunden + Zeitraum (Datenschutz & Korrektheit).

---

## 6) Zusammenspiel mit Mahnwesen/Rechnung/Angebot

### 6.1 Ereignisbasierte Chronik

Wenn in Rechnung/Mahnung etwas passiert, soll es als Ereignis im Kundenbericht auftauchen:

* Status geändert (bezahlt / genehmigt / versendet)
* Folgemahnung erstellt
* Angebot angenommen/abgelehnt

### 6.2 Konsistente Statusanzeige

* Rechnung bezahlt → Mahnungen erledigt (wie zuvor definiert)
* Kundenbericht muss diese Logik reflektieren:

  * offene Mahnungen verschwinden
  * offene Beträge sinken

---

# Roadmap Umsetzung (Sprints)

## Sprint 1 — Grundgerüst Kundenberichte

* Route `/kundenberichte` + KPI-Cards + Kundenliste (Tabelle)
* Action „Bericht öffnen“
* Route `/kundenberichte/:kundeId` mit Header + globalem Zeitraumfilter
* Tabs (Platzhalter) + erste Datenabfragen

## Sprint 2 — Datenintegration je Tab

* Anfragen/Angebote/Rechnungen/Mahnungen/Projekte listen + Filter
* Drill-down Links zu Detailseiten
* Aktivitätsfeed / Timeline aus Chroniken generieren

## Sprint 3 — Statistiken & Reports

* KPI-Berechnungen pro Kunde
* Charts/Reports (Umsatzverlauf, offene Beträge, Anzahl Vorgänge)
* Export (CSV zuerst, PDF später)

## Sprint 4 — KI-Features

* KI-Zusammenfassung pro Zeitraum (read-only)
* KI-Report-Generierung mit Abschnitten
* Speicherung der Report-Version (damit er reproduzierbar ist)
* Optional: KI-Chat auf Kundenkontext

---

## Zusätzliche Ideen (wertvoll in der Praxis)

* **Kunden-Tags** (VIP, Mahnsperre, Risiko, Großkunde)
* **Nächste Schritte / ToDos** pro Kunde (z. B. „Anrufen“, „Zahlung prüfen“, „Neues Angebot erstellen“)
* **Rahmenvertrag-Status** (ja/nein, Konditionen)
* **Dokumentenbereich** (alle PDFs: Angebote/Rechnungen/Mahnungen gebündelt)
* **Team-Notizen** (CRM-Style, internes Log)

---

